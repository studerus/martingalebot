% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/add_roc_filter.R
\name{add_roc_filter}
\alias{add_roc_filter}
\title{Add a Rate of Change (ROC) based signal filter to a data.table}
\usage{
add_roc_filter(
  dt,
  time_period = "1 day",
  n = 90,
  cutoff = -30,
  smoothing_period = 0,
  column_name = "emergency_stop",
  roc_is_below = TRUE
)
}
\arguments{
\item{dt}{A \code{data.table} containing 'time' and 'price' columns, sorted by time.}

\item{time_period}{The time frame for resampling. Defaults to \code{"1 day"}.}

\item{n}{The number of lookback periods for the ROC calculation (e.g., 90 for 90 days).}

\item{cutoff}{The ROC percentage threshold (e.g., -30 for a 30\% drop).}

\item{smoothing_period}{An integer. If > 0, an SMA of this period is applied to the
price data \emph{before} calculating the ROC. This smooths the price and makes the
signal more robust. Defaults to 0 (no smoothing).}

\item{column_name}{The name of the logical column to be created. Defaults to \code{"emergency_stop"}.}

\item{roc_is_below}{If \code{TRUE} (default), the signal is \code{TRUE} when ROC < cutoff.
If \code{FALSE}, the signal is \code{TRUE} when ROC > cutoff.}
}
\value{
The \code{data.table} \code{dt} is returned after being modified in place.
}
\description{
This function calculates the Rate of Change (ROC) indicator on a resampled
time series. ROC measures the percentage change in price between the current
price and the price \code{n} periods ago. It is a pure momentum oscillator.

This filter is particularly useful for creating an \code{emergency_stop} signal
based on strong, sustained downward momentum. To improve signal stability and
reduce false positives from single volatile candles ("wicks"), the calculation
can be performed on a smoothed price line (e.g., a 7-day SMA of the price).

The function modifies the input \code{data.table} by reference.
}
\examples{
\dontrun{
# Use a long-term dataset to see the effect of the ROC emergency stop.
dat <- get_binance_prices_from_csv(
  'BTCUSDT',
  start_time = '2020-01-01',
  end_time = '2022-12-31',
  progressbar = FALSE
) |>
  add_roc_filter(
    time_period = "1 day",
    n = 90,
    cutoff = -40,
    smoothing_period = 7, # <-- Use a 7-day smoothed price for ROC calculation
    column_name = "emergency_stop"
  )

# Find when the emergency stop was triggered
print(dat[emergency_stop == TRUE])
}
}
\seealso{
\code{\link{add_sma_filter}}, \code{\link{add_rsi_filter}}
}
