% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/down_tolerance.R
\name{down_tolerance}
\alias{down_tolerance}
\title{Calculate the "price down tolerance" for a specific parameter setting}
\usage{
down_tolerance(
  base_order_volume,
  first_safety_order_volume,
  n_safety_orders,
  pricescale,
  volumescale,
  take_profit,
  stepscale
)
}
\arguments{
\item{base_order_volume}{The size of the base order (in the quote currency)}

\item{first_safety_order_volume}{The size of the first safety order (in
the quote currency)}

\item{n_safety_orders}{The maximum number of safety orders}

\item{pricescale}{Price deviation to open safety orders (\% from initial
order)}

\item{volumescale}{With what number should the funds used by the last safety
order be multiplied?}

\item{take_profit}{At what percentage in profit should the bot close the
deal?}

\item{stepscale}{With what number should the price deviation percentage used
by the last safety order be multiplied?}
}
\value{
a numeric vector of price down tolerances
}
\description{
This function calculates the price down tolerance, i.e. the percentage
price deviation from the initial order price to the take profit price when
all safety orders are filled.
}
\details{
Implementation detail: The calculation uses the weighted-average purchase
price per coin (WAP). If \eqn{V_i} are the order sizes in quote currency and
the order prices are \eqn{P_i = P_0 (1 - d_i/100)}, then the average cost per
coin is
\deqn{\bar P = \frac{\sum_i V_i}{\sum_i V_i / P_i}.}
The take profit price is
\deqn{P_{TP} = \bar P\, (1 + \mathrm{take\_profit}/100).}
Since \eqn{P_i} are proportional to \eqn{P_0}, the ratio simplifies to
\deqn{\frac{P_{TP}}{P_0} = (1 + \mathrm{take\_profit}/100)\, \frac{\sum_i V_i}{\sum_i V_i / (1 - d_i/100)}.}
Therefore, the down tolerance (percentage drop from start price to TP price) is
\deqn{100\,\left(1 - \frac{P_{TP}}{P_0}\right) = 100\,\left(1 - (1 + \mathrm{take\_profit}/100)\, \frac{\sum_i V_i}{\sum_i V_i / (1 - d_i/100)}\right).}

This matches the intuitive definition and the visualization used in
\code{plot_martingale_config(plot_type = "allocation")}.
}
\examples{
down_tolerance(base_order_volume = 10, first_safety_order_volume = 10,
               n_safety_orders = 8, pricescale = 1.5, volumescale = 1.5,
               take_profit = 3, stepscale = 1.2)
}
