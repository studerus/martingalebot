---
title: "Introduction to the martingalebot package in R"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to the martingalebot package in R}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  markdown: 
    wrap: 72
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(martingalebot)
```

The `martingalebot` package provides functions to download
cryptocurrency price data from Binance and to perform backtesting and
parameter optimization for a single pair martingale trading strategy as
implemented by single pair dca bots on [3commas](https://3commas.io/),
[Pionex](https://www.pionex.com/),
[TradeSanta](https://tradesanta.com/), [Mizar](https://mizar.com/),
[OKX](https://www.okx.com/learn/introducing-the-spot-dollar-cost-averaging-dca-bot),
[Bitget](https://www.bitget.com/en/academy/article-details/Bitget-DCA-Strategy-A-Hands-on-Tutorial)
and others.

### Downloading price data

There are three different functions to download data from Binance:
`get_binance_klines(),` `get_binance_klines_from_csv()`,
`get_binance_prices_from_csv`. The function `get_binance_klines()` can
download candlestick data directly. The user can specify the trading
pair, the start and end time and the time frame for the candles. For
example, to download hourly candles from `ETHUSDT` from the first of
January to the first of March 2023, one could specify:

```{r}
get_binance_klines(symbol = 'ETHUSDT',
                   start_time = '2025-01-01',
                   end_time = '2025-03-01',
                   interval = '1h')
```

An advantage of `get_binance_klines()` is that it can download price
data up to the current time. A disadvantage is that the lowest time
frame for the candles is 1 minute.

The function `get_binance_klines_from_csv()` downloads candlestick data
via csv files from <https://data.binance.vision/>. The advantage of this
method is that it is faster for large amounts of data and that that the
lowest time frame for the candles is 1 second. A disadvantage is that it
can only download price data up to 1-2 days ago as the csv files on
[https://data.binance.vision](https://data.binance.vision/) are only
updated once per day.

The function `get_binance_prices_from_csv()` also downloads price data
via csv files from <https://data.binance.vision/> and thus shares the
same advantages and disadvantages, but it downloads aggregated trades
instead of candlestick data. This allows for an even lower time
resolution as it returns all traded prices of a coin over time. Knowing
the exact price at each point in time is particularly helpful for
backtesting martingale bots with trailing buy and sell orders. The
function `get_binance_prices_from_csv()` returns a data frame with only
two columns. See, for example:

```{r}
get_binance_prices_from_csv('LTCBTC',
                            start_time = '2025-01-01',
                            end_time = '2025-02-01', progressbar = F)
```

Since this function returns very large amounts of data for frequently
traded pairs such as `BTCUSDT`, it is, by default, parallelized and
shows a progress bar. Currently, the functions `backtest` and
`grid_search` are implemented in such a way that they expect the price
data to be in the format as returned by this function.


### Visualizing a Martingale Configuration

Before running scans, you can quickly inspect how a parameter set allocates capital across safety orders, where orders are placed, and where the takeâ€‘profit lands.

```{r, dev='svg', out.width='100%', fig.width=8, fig.asp=0.6, fig.align='center'}
# Capital allocation by price level (horizontal stacked bars)
plot_martingale_config(
  starting_price = 100,
  n_safety_orders = 8,
  pricescale = 2.4,
  volumescale = 1.5,
  take_profit = 2.4,
  stepscale = 1.1, 
  plot_type = "allocation"
)
```

```{r, dev='svg', out.width='100%', fig.width=8, fig.asp=0.6, fig.align='center'}
# Timeline view (order sequence with buy amounts and final TP point)
plot_martingale_config(
  starting_price = 100,
  n_safety_orders = 8,
  pricescale = 2.4,
  volumescale = 1.5,
  take_profit = 2.4,
  stepscale = 1.1,
  plot_type = "timeline"
)
```
